{"version":3,"sources":["../../src/server/createS3PresignHandler.ts"],"names":["S3Client","PutObjectCommand","getSignedUrl"],"mappings":";;;;;;AAkBO,SAAS,uBAAuB,MAAA,EAAuB;AAC1D,EAAA,MAAM,EAAA,GAAK,IAAIA,iBAAA,CAAS;AAAA,IACpB,QAAQ,MAAA,CAAO,MAAA;AAAA,IACf,WAAA,EAAa;AAAA,MACT,aAAa,MAAA,CAAO,WAAA;AAAA,MACpB,iBAAiB,MAAA,CAAO;AAAA;AAC5B,GACH,CAAA;AAED,EAAA,OAAO,eAAe,uBAAA,CAAwB;AAAA,IAC1C,QAAA;AAAA,IACA,WAAA;AAAA,IACA;AAAA,GACJ,EAAmB;AACf,IAAA,IAAI,CAAC,QAAA,IAAY,CAAC,WAAA,EAAa;AAC3B,MAAA,MAAM,IAAI,MAAM,uCAAuC,CAAA;AAAA,IAC3D;AAEA,IAAA,MAAM,GAAA,GAAM,GAAG,MAAA,IAAU,SAAS,IAAI,IAAA,CAAK,GAAA,EAAK,CAAA,CAAA,EAAI,QAAQ,CAAA,CAAA;AAE5D,IAAA,MAAM,OAAA,GAAU,IAAIC,yBAAA,CAAiB;AAAA,MACjC,QAAQ,MAAA,CAAO,MAAA;AAAA,MACf,GAAA,EAAK,GAAA;AAAA,MACL,WAAA,EAAa;AAAA,KAChB,CAAA;AAED,IAAA,MAAM,SAAA,GAAY,MAAMC,+BAAA,CAAa,EAAA,EAAI,OAAA,EAAS;AAAA,MAC9C,SAAA,EAAW,OAAO,SAAA,IAAa;AAAA,KAClC,CAAA;AAED,IAAA,OAAO;AAAA,MACH,SAAA;AAAA,MACA,GAAA;AAAA,MACA,SAAA,EAAW,CAAA,EAAG,MAAA,CAAO,SAAS,IAAI,GAAG,CAAA;AAAA,KACzC;AAAA,EACJ,CAAA;AACJ","file":"index.js","sourcesContent":["import { S3Client, PutObjectCommand } from '@aws-sdk/client-s3';\nimport { getSignedUrl } from '@aws-sdk/s3-request-presigner';\n\nexport interface PresignConfig {\n    region: string;\n    accessKeyId: string;\n    secretAccessKey: string;\n    bucket: string;\n    publicUrl: string;\n    expiresIn?: number;\n}\n\nexport interface PresignRequest {\n    fileName: string;\n    contentType: string;\n    folder?: string;\n}\n\nexport function createS3PresignHandler(config: PresignConfig) {\n    const s3 = new S3Client({\n        region: config.region,\n        credentials: {\n            accessKeyId: config.accessKeyId,\n            secretAccessKey: config.secretAccessKey,\n        },\n    });\n\n    return async function generatePresignedUpload({\n        fileName,\n        contentType,\n        folder,\n    }: PresignRequest) {\n        if (!fileName || !contentType) {\n            throw new Error('fileName and contentType are required');\n        }\n\n        const key = `${folder || 'uploads'}/${Date.now()}-${fileName}`;\n\n        const command = new PutObjectCommand({\n            Bucket: config.bucket,\n            Key: key,\n            ContentType: contentType,\n        });\n\n        const signedUrl = await getSignedUrl(s3, command, {\n            expiresIn: config.expiresIn ?? 300,\n        });\n\n        return {\n            signedUrl,\n            key,\n            publicUrl: `${config.publicUrl}/${key}`,\n        };\n    };\n}"]}